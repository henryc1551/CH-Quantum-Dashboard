<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quantum Dashboard Pro</title>
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
  <style>
    body { background:#101010; color:#fff; }
    header { text-align:center; margin-bottom:2rem; }
    .grid { display:flex; flex-wrap:wrap; gap:1rem; }
    .card { flex:1; min-width:280px; background:#181818; padding:1rem; border-radius:12px; }
    .row { margin:0.5rem 0; }
    .btn { margin:0.25rem; }
    .muted { color:#888; font-size:0.8rem; }
  </style>
</head>
<body>
  <header>
    <h1>âš¡ Quantum Dashboard Pro</h1>
    <p>All-in-One Projects &amp; Games Hub</p>
  </header>

  <main class="grid">

    <section class="card">
      <h3>ðŸ”‘ Logowanie</h3>
      <input id="loginPass" type="password" placeholder="HasÅ‚o" />
      <button id="loginBtn" class="btn">Zaloguj</button>
      <p id="loginStatus" class="muted"></p>
    </section>

    <section class="card">
      <h3>ðŸ“‚ Projekty</h3>
      <ul id="projectList"></ul>
      <button id="refreshBtn" class="btn">OdÅ›wieÅ¼</button>
    </section>

    <section class="card">
      <h3>ðŸ¤– Chat Asystenta</h3>
      <textarea id="chatInput" placeholder="Zadaj pytanieâ€¦" rows="3"></textarea>
      <button id="sendChat" class="btn">WyÅ›lij</button>
      <pre id="chatLog" style="max-height:200px; overflow:auto;"></pre>
    </section>

    <section class="card">
      <h3>ðŸŽ® Grafika (presety)</h3>
      <div class="row">
        <select id="gfxPreset">
          <option value="mobile">Mobile (lekko)</option>
          <option value="high" selected>High (SSR/SSGI)</option>
          <option value="ultra-rt">Ultra RT (WebGPU / Path Tracing)</option>
        </select>
      </div>
      <div class="row">
        <button id="gfxLoad" class="btn">Wczytaj</button>
        <button id="gfxSaveGlobal" class="btn">Zapisz globalnie</button>
        <button id="gfxSaveUser" class="btn">Zapisz dla mnie</button>
      </div>
      <small class="muted">Ultra-RT wymaga WebGPU. Inaczej fallback do High.</small>
    </section>

  </main>

  <script type="module">
    // === LOGIN ===
    const PASS = "przyjaÅºÅ„";
    const loginBtn = document.getElementById("loginBtn");
    loginBtn.onclick = () => {
      const val = document.getElementById("loginPass").value;
      if(val === PASS){
        document.getElementById("loginStatus").textContent = "âœ… Zalogowano!";
      } else {
        document.getElementById("loginStatus").textContent = "âŒ ZÅ‚e hasÅ‚o.";
      }
    };

    // === PROJECTS ===
    async function loadProjects(){
      const res = await fetch("/project.json").then(r=>r.json()).catch(()=>({projects:[]}));
      const ul = document.getElementById("projectList");
      ul.innerHTML = "";
      res.projects.forEach(p=>{
        const li = document.createElement("li");
        li.textContent = p.name + " â€” " + p.desc;
        ul.appendChild(li);
      });
    }
    document.getElementById("refreshBtn").onclick = loadProjects;
    loadProjects();

    // === CHAT (stub) ===
    const chatLog = document.getElementById("chatLog");
    document.getElementById("sendChat").onclick = () => {
      const val = document.getElementById("chatInput").value;
      chatLog.textContent += "\\n> " + val;
      document.getElementById("chatInput").value = "";
    };

    // === GFX PRESETS ===
    function uid(){ return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16)); }
    let USER_ID = localStorage.getItem("qdp-user-id");
    if(!USER_ID){ USER_ID = "u-"+uid(); localStorage.setItem("qdp-user-id", USER_ID); }

    const gfxSel = document.getElementById("gfxPreset");
    async function gfxLoad(id){
      const q = id ? `?id=${encodeURIComponent(id)}` : "";
      const r = await fetch(`/api/gfx/get${q}`);
      const j = await r.json();
      if (j.ok && j.preset) gfxSel.value = j.preset;
    }
    async function gfxSaveGlobal(){
      await fetch("/api/gfx/set", {
        method:"POST", headers:{ "content-type":"application/json" },
        body: JSON.stringify({ preset: gfxSel.value })
      });
      alert("Zapisano globalnie");
    }
    async function gfxSaveUser(){
      await fetch("/api/gfx/set", {
        method:"POST", headers:{ "content-type":"application/json" },
        body: JSON.stringify({ id: USER_ID, preset: gfxSel.value })
      });
      alert("Zapisano dla Ciebie");
    }
    document.getElementById("gfxLoad").onclick = ()=> gfxLoad(USER_ID);
    document.getElementById("gfxSaveGlobal").onclick = gfxSaveGlobal;
    document.getElementById("gfxSaveUser").onclick = gfxSaveUser;
    gfxLoad(USER_ID);
  </script>
</body>
</html>
